<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monaco Definition Provider Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      margin: 0;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      margin-top: 0;
      color: #569cd6;
    }
    .container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .editor-container {
      flex: 1;
      min-width: 400px;
    }
    .editor-container h2 {
      color: #4ec9b0;
      margin-bottom: 10px;
    }
    #python-editor, #typescript-editor {
      width: 100%;
      height: 400px;
      border: 1px solid #3c3c3c;
    }
    .instructions {
      background: #2d2d2d;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .instructions ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    .instructions code {
      background: #3c3c3c;
      padding: 2px 6px;
      border-radius: 3px;
      color: #ce9178;
    }
    .log {
      background: #2d2d2d;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log h3 {
      margin-top: 0;
      color: #dcdcaa;
    }
    .log-entry {
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
      padding: 5px 0;
      border-bottom: 1px solid #3c3c3c;
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .log-external {
      color: #4fc1ff;
    }
    .log-local {
      color: #4ec9b0;
    }
  </style>
</head>
<body>
  <h1>Monaco Definition Provider Demo</h1>
  
  <div class="instructions">
    <strong>How to use:</strong>
    <ul>
      <li>Hold <code>Ctrl</code> (or <code>Cmd</code> on Mac) and click on a symbol to jump to its definition</li>
      <li>Use <code>F12</code> or right-click â†’ "Go to Definition"</li>
      <li>Try clicking on function names, class names, and imported symbols</li>
      <li>External navigation callbacks are logged below</li>
    </ul>
  </div>
  
  <div class="container">
    <div class="editor-container">
      <h2>Python</h2>
      <div id="python-editor"></div>
    </div>
    <div class="editor-container">
      <h2>TypeScript</h2>
      <div id="typescript-editor"></div>
    </div>
  </div>
  
  <div class="log">
    <h3>Navigation Log</h3>
    <div id="log-content"></div>
  </div>

  <script type="module">
    import * as monaco from 'https://esm.sh/monaco-editor@0.52.0';
    import { DefinitionProvider } from '/src/index.ts';
    
    // Initialize Monaco AMD loader for workers
    self.MonacoEnvironment = {
      getWorkerUrl: function(moduleId, label) {
        return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
          self.MonacoEnvironment = { baseUrl: 'https://esm.sh/monaco-editor@0.52.0/min/' };
          importScripts('https://esm.sh/monaco-editor@0.52.0/min/vs/base/worker/workerMain.js');
        `)}`;
      }
    };
    
    function log(message, type = 'local') {
      const logContent = document.getElementById('log-content');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logContent.insertBefore(entry, logContent.firstChild);
    }
    
    // Create definition provider with external navigation callback
    const provider = new DefinitionProvider({
      onExternalNavigation: async (symbolName, importPath, currentUri) => {
        log(`External navigation requested: ${symbolName} from "${importPath}"`, 'external');
        
        // In a real application, you would:
        // 1. Resolve the import path to an actual file
        // 2. Load or fetch the file content
        // 3. Find the symbol definition in that file
        // 4. Return the location
        
        // For demo purposes, we'll just log and return null
        return null;
      }
    });
    
    // Python sample code
    const pythonCode = `# Python Demo - Click on symbols to navigate!

from math import sqrt, pi
from typing import List, Dict
import json

# Try clicking on 'greet' below to jump here!
def greet(name: str) -> str:
    """Say hello to someone."""
    return f"Hello, {name}!"

class Calculator:
    """A simple calculator class."""
    
    def __init__(self):
        self.result = 0
    
    def add(self, a: int, b: int) -> int:
        """Add two numbers."""
        return a + b
    
    def square_root(self, n: float) -> float:
        """Calculate square root using imported sqrt."""
        return sqrt(n)  # Click on 'sqrt' - external!

# Usage examples
message = greet("World")  # Click on 'greet' here!
calc = Calculator()  # Click on 'Calculator' here!

# Click on 'json' or 'pi' to see external navigation
data = json.dumps({"pi": pi})
`;

    // TypeScript sample code
    const typescriptCode = `// TypeScript Demo - Click on symbols to navigate!

import { readFile } from 'fs';
import * as path from 'path';

// Click on 'User' below to jump here!
interface User {
  id: number;
  name: string;
  email: string;
}

// Click on 'greet' references to jump here!
function greet(user: User): string {
  return \`Hello, \${user.name}!\`;
}

// Arrow function - click on 'double' to jump here!
const double = (n: number): number => n * 2;

class UserService {
  private users: User[] = [];
  
  addUser(user: User): void {
    this.users.push(user);
  }
  
  findUser(id: number): User | undefined {
    return this.users.find(u => u.id === id);
  }
}

// Usage examples
const service = new UserService();  // Click on 'UserService'!

const newUser: User = {  // Click on 'User'!
  id: 1,
  name: "Alice",
  email: "alice@example.com"
};

service.addUser(newUser);
const message = greet(newUser);  // Click on 'greet'!
const value = double(21);  // Click on 'double'!

// Click on 'readFile' or 'path' to see external navigation
`;

    // Create Python editor
    const pythonEditor = monaco.editor.create(document.getElementById('python-editor'), {
      value: pythonCode,
      language: 'python',
      theme: 'vs-dark',
      minimap: { enabled: false },
      fontSize: 14,
      lineNumbers: 'on',
      automaticLayout: true
    });
    
    // Create TypeScript editor
    const typescriptEditor = monaco.editor.create(document.getElementById('typescript-editor'), {
      value: typescriptCode,
      language: 'typescript',
      theme: 'vs-dark',
      minimap: { enabled: false },
      fontSize: 14,
      lineNumbers: 'on',
      automaticLayout: true
    });
    
    // Register the provider for both languages
    provider.register('python');
    provider.register('typescript');
    
    log('Definition provider initialized for Python and TypeScript', 'local');
  </script>
</body>
</html>
